<div class="loader" *ngIf="isLoader"></div>
<div class="container-fluid">
  <div class="row">
    <div class="col-md-12 col-xs-12">
      <div class="dialog-body">
        <nb-card>
          <nb-card-body>
            <form id=“form-buscar-atendimento” [formGroup]="formBuscarAtendimento">
              <div class="text-right">
                <button class="btn btn-success" type="button" data-toggle="collapse" data-target="#filtrosAtendimento" aria-expanded="false" aria-controls="filtrosAtendimento">
                  <b class="fas fa-filter"></b> Exibir Filtros <span class="arrow">▾</span>
                </button>
              </div>
              
              <div class="form-group">
                <h5>Atendimentos</h5>
              </div>

              <div class="col-md-12 col-xs-12">
                <div class="collapse" id="filtrosAtendimento">

                <div class="form-row align-items-center">
                  <div class="form-group col-md-4 ">
                    <div class="form-group">
                      <label for="medico">Informe o Médico* </label>
                      <select class="form-control" id="medico" formControlName="medico">
                        <option value="{{ listMedico }}" selected>Selecione o Médico</option>
                        <option *ngFor="let medico of listMedico" [value]="medico.id">
                          <!-- use value instead of ngValue -->
                          {{ medico.ID }} {{ medico.name }}
                        </option>
                      </select>
                    </div>
                  </div>
                  <div class="form-group col-md-4">
                    <div class="form-group">
                      <div class="div-clinica">
                        <label for="clinica">Informe a Clínica*</label>
                        <select class="form-control" formControlName="clinica">
                          <option value="null" selected>SELECIONE</option>
                          <option *ngFor="let clinica of listClinica" value="{{ clinica.id }}">{{
                            clinica.name}}</option>
                        </select>
                      </div>
                    </div>
                  </div>
                  <div class="form-group col-md-4">
                    <div class="form-group">
                      <label for="tipoConsulta">Informe a Modalidade*</label>
                      <select class="form-control" formControlName="tipoConsulta">
                        <option value="null" selected>SELECIONE</option>
                        <option *ngFor="let tipoConsulta of listTipoConsulta" value="{{ tipoConsulta.id }}">{{
                          tipoConsulta.descricao}}</option>
                      </select>
                    </div>
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group col-md-4">
                    <label for="dataInicio">Período Inicial*</label>
                    <input class="form-control date" type="date" id="dataInicio" name="Data Início" [value]="TodayDate"
                       formControlName="dataInicio" />
                  </div>
                  <div class="form-group col-md-4">
                    <label for="dataFim">Período Final*</label>
                    <input class="form-control date" type="date" id="dataFim" name="Data Fim" [value]="FinalDate"
                   formControlName="dataFim" />
                  </div>
                  <div class="form-group col-md-4">
                    <label for="status">Situação Desejada</label>
                    <select class="form-control" formControlName="status">
                      <option value="null" selected>SELECIONE</option>
                      <option *ngFor="let status of tipo" value="{{ status.status }}">
                        {{ status.descricao }}
                      </option>
                    </select>
                  </div>
                </div>
              <!--  <div class="form-row">
                  <div class="form-group col-md-4">
                    <div class="form-group">
                      <div class="div-nome">
                        <label for="nome">Nome do Paciente</label>
                        <input class="form-control" name="nome" id="nome" type="text" formControlName="nome"
                          placeholder="Nome do paciente" />
                      </div>
                    </div>
                  </div>
                  <div class="form-group col-md-3">
                    <div class="form-group">
                      <div class="div-cpf">
                        <label for="cpf">CPF do Paciente</label>
                        <input class="form-control" name="cpf" id="cpf" type="text" formControlName="cpf"
                          mask="000.000.000-00" maxlength="14" (change)="isValidCpf(formBuscarAtendimento.value)"
                          placeholder="000.000.000-00" />

                      </div>
                    </div>
                  </div>
                </div>
-->
              </div>
            </div>

            <div class="form-group">
              <div class="form-group pt-4">
                <div class="text-right">
                  <button class="btn btn-primary mr-2 button"
                    (click)="buscarAtendimento(formBuscarAtendimento.value,true)">
                    Buscar
                  </button>
                  <button class="btn btn-success ml-2 button" (click)="agendarAtendimento(formBuscarAtendimento.value)">
                    Agendar
                  </button>
                  <button class="btn btn-warning ml-2 button" (click)="BloquearAtendimento(formBuscarAtendimento.value)">
                    Bloquear
                  </button>
                  <button class="btn btn-danger ml-2 button" (click)="AnteciparAtendimento(formBuscarAtendimento.value)">
                    Fila
                  </button>
                </div>
              </div>
            </div>

            
            <h5>Ícones:</h5>
            <div class="col-md-12 col-xs-12">
              <div class="row">
                <div class="legend d-flex flex-wrap">
                  <p class="mr-3 mb-2">
                    <i class="fa fa-info-circle text-primary"></i> Detalhe Do Atendimento
                  </p>
                  <p class="mr-3 mb-2">
                    <i class="fa fa-wifi text-success"></i> Iniciar Atendimento
                  </p>
                  <p class="mr-3 mb-2">
                    <i class="fa fa-video text-danger"></i> Iniciar Video Atendimento
                  </p>
                  <p class="mr-3 mb-2">
                    <i class="fa fa-key text-warning"></i> Desbloquear Horário
                  </p>
                  <p class="mb-2">
                    <i class="fa fa-clock text-danger"></i> Confirmar Horário
                  </p>
                </div>
              </div>
            </div>

            <div class="legenda col-xs-12">
              <h5>Atendimentos:</h5>
              <div class="legenda-container row">
                <div class="legenda-item col-md-3 col-xs-12">
                  <div class="cor-box card-pendente"></div>
                  <span>Pagamento Pendente</span>
                </div>
                <div class="legenda-item col-md-3 col-xs-12">
                  <div class="cor-box card-bloqueado"></div>
                  <span>Horário Bloqueado</span>
                </div>
                <div class="legenda-item col-md-3 col-xs-12">
                  <div class="cor-box card-confirmada"></div>
                  <span>Consulta Confirmada</span>
                </div>
                <div class="legenda-item col-md-3 col-xs-12">
                  <div class="cor-box card-finalizado"></div>
                  <span>Consulta Finalizada</span>
                </div>
              </div>
            </div>
            
            
            
                        
              <h5>Horários Agendados:</h5>

              <div class="row">
                <div class="col-md-4" *ngFor="let row of rowData">
                  <div class="card mb-3" [ngClass]="{
                    'card-pendente': row.status === '02 - Aguardando Pagamento',
                    'card-bloqueado': row.nomeResponsavel === 'Bloqueado',
                    'card-finalizado': row.status === '04 - Consulta Finalizada',
                    'card-confirmada': row.status === '03 - Consulta Confirmada'
                  }">
                    <div class="card-body">
                      <!-- Div para o avatar à direita -->
                      <div class="text-right">
                        <img src="{{row?.avatar || this.avatar}}" style="height: 55px; border-radius: 50%; float: right;">
                      </div>
                      <!-- Conteúdo do texto -->
                      <h6 class="card-title">Data: {{ row?.data }}</h6>
                      <h6 class="card-title">Horário: {{ row?.horario }}</h6>
                      <p class="card-text">Paciente: {{ row?.nomeDependente || row?.nomeResponsavel }}</p>
                      <p class="card-text">Responsável: {{ row?.nomeResponsavel }}</p>
                      <p class="card-text">Modalidade: {{ row?.modalidade }}</p>
                      <p class="card-text">Situação: {{ row?.status }}</p>
                      <p class="card-text">Telefone: {{ row?.telefone }}</p>
                      <p class="card-text">
                        Consulta Confirmada:
                        <span [style.font-weight]="row?.isConfirmed === 'Confirmado' ? 'bold' : 'bold'" [style.color]="row?.isConfirmed === 'Confirmado' ? 'green' : 'red'">
                          {{ row?.isConfirmed }}
                        </span>
                      </p>
                      <!-- Botões -->
                      <div class="text-center">
                        <button style="margin: 0 15px;"  class="btn btn-primary mb-2" (click)="detalhes(row)"
                          *ngIf="row.nomeResponsavel !== 'Bloqueado'" title="Detalhes do Atendimento">
                          <i class="fa fa-info-circle"></i>
                        </button>
                        <button style="margin: 0 15px;" class="btn btn-success mb-2" (click)="iniciarAtendimento(row)"
                          *ngIf="row && row.atendimento && row.atendimento.status === '03 - Consulta Confirmada'" title="Iniciar Atendimento">
                          <i class="fa fa-wifi"></i>
                        </button>
                        <button style="margin: 0 15px;"  class="btn btn-danger mb-2" (click)="videoAtendimento(row)"
                          *ngIf="row && row.atendimento.meetingUrl !== null && row.atendimento.status === '03 - Consulta Confirmada'" title="Inicio Video Atendimento">
                          <i class="fa fa-video"></i>
                        </button>
                        <button style="margin: 0 15px;" class="btn btn-warning mb-2" (click)="desbloquear(row)"
                        *ngIf="row.nomeResponsavel === 'Bloqueado' && row.status !== '04 - Consulta Finalizada'" title="Desbloquear Horário">
                        <i class="fa fa-key"></i>
                      </button>

                        <button style="margin: 0 15px;"  class="btn btn-danger mb-2" (click)="confirmarHorario(row)"
                        *ngIf="row.isConfirmed ==='Não Confirmado'  && row.status !== '04 - Consulta Finalizada' && row.nomeResponsavel !== 'Bloqueado'" title="Confirmar Horário">
                        <i class="fa fa-clock"></i>
                      </button>
                                          </div>
                    </div>
                  </div>
                </div>
              </div>

              <h5>Horários Disponíveis:</h5>

              <div class="row">
                <!-- Verifique se a matriz 'rowData2' está vazia -->
                <ng-container *ngIf="rowData2 === null; else showData">
                  <p>Não foram encontrados horários disponíveis no período informado.</p>
                </ng-container>
              
                <!-- Caso haja dados, exiba-os -->
                <ng-template #showData>
                  <div class="col-md-4" *ngFor="let row of rowData2">
                    <div class="mb-3" [ngClass]="{
                      'card-livre': row.status === 'Disponível'
                    }">
                      <div class="card-body">
                        <h6 class="card-title"> Data: {{ row?.data }} </h6>
                        <h6 class="card-title"> Horário: {{ row?.horario }}</h6>
              
                        <div class="text-center">
                          <button class="btn btn-success mb-2" (click)="AgendaDefinida(row)" title="Agendar">
                            <i class="fa fa-info-circle"></i> Agendar
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </ng-template>
              </div>
              
              <!--
              <div class="form-row">
                <div class="form-group col-md-12">
                  <div class="app-box">
                    <ngx-datatable #myTable class="bootstrap" [rows]="rowData" [columnMode]="'force'"
                      [headerHeight]="35" [footerHeight]="50" [rowHeight]="'auto'"
                      [messages]="{ emptyMessage: 'Não Foram Encontrado Atendimentos' }" [limit]="40">
                                     
                      <ngx-datatable-column name="Horário" prop="data">
                        <ng-template ngx-datatable-cell-template let-row="row">
                          <div class="text-center">
                            {{ row?.data }} {{ row?.horario }}
                          </div>
                        </ng-template>
                      </ngx-datatable-column>
                      <ngx-datatable-column name="Paciente" prop="nome">
                        <ng-template ngx-datatable-cell-template let-row="row">
                          <div class="text-center">
                            {{ row?.nome }}
                          </div>
                        </ng-template>
                      </ngx-datatable-column>

                      <ngx-datatable-column name="Modalidade" prop="modalidade">
                        <ng-template ngx-datatable-cell-template let-row="row">
                          <div class="text-center">
                            {{ row?.modalidade }}
                          </div>
                        </ng-template>
                      </ngx-datatable-column>
                      
                      <ngx-datatable-column name="Status" prop="status">
                        <ng-template ngx-datatable-cell-template let-row="row">
                          <div class="text-center">
                            {{ row?.status }}
                          </div>
                        </ng-template>
                      </ngx-datatable-column>
                      <ngx-datatable-column name="Ações" prop="acoes">
                        <ng-template ngx-datatable-cell-template let-row="row">
                          <div class="datatable-body-box-actions">
                            <button class="btn home-icon" (click)="detalhes(row)" title="Detalhe">
                              <i class="fa fa-info-circle"></i>
                            </button>
                            <button class="btn home-icon" (click)="iniciarAtendimento(row)" title="Iniciar atendimento"
                            *ngIf="row && row.atendimento && row.atendimento.status !== '01 - Aguardando Aprovação' && row.atendimento.status !== '05 - Consulta Cancelada'">                              <i class="fa fa-wifi"></i>
                            </button>
                            <button class="btn home-icon" (click)="videoAtendimento(row)" title="Vídeo atendimento"
                              *ngIf="row && row.atendimento.meetingUrl !== null">
                              <i class="fa fa-video"></i>
                            </button>
                          </div>
                        </ng-template>
                      </ngx-datatable-column>
                      <ngx-datatable-footer>
                        <ng-template ngx-datatable-footer-template let-rowCount="rowCount" let-pageSize="pageSize"
                          let-selectedCount="selectedCount" let-curPage="curPage" let-offset="offset">
                          <div>
                            <div class="page-count">
                              Total de Registros: {{ rowCount }}
                            </div>
                          </div>
                          <datatable-pager [pagerLeftArrowIcon]="'fa fa-angle-double-left'"
                            [pagerRightArrowIcon]="'fa fa-angle-double-right '" [pagerPreviousIcon]="'fa fa-angle-left'"
                            [pagerNextIcon]="'fa fa-angle-right '" [page]="curPage" [size]="pageSize" [count]="rowCount"
                            [hidden]="!(rowCount / pageSize > 1)" (change)="myTable.onFooterPage($event)">
                          </datatable-pager>
                        </ng-template>
                      </ngx-datatable-footer>
                    </ngx-datatable>
                  </div>
                </div>
              </div>
       -->
            </form>
          </nb-card-body>
        </nb-card>
      </div>
    </div>
  </div>
</div>
