<div class="loader" *ngIf="isLoader"></div>

<div class="container-fluid">
    <div class="row">
        <div class="col-md-12 col-xs-12">
            <div class="dialog-body">
                <nb-card>
                    <nb-card-body>
                        <div class="form-row">
                            <nb-card-header class="aditi-header">
                              <div class="back-link">
                                <a class="m-lg-n3" (click)="previousPage()" aria-label="back">
                                  <nb-icon icon="arrow-back" title="voltar"></nb-icon>
                                </a>
                              </div>
                            </nb-card-header>
                            <div class="form-group col-md-12 input-medica">
                              <div class="d-flex align-items-center"> <!-- Removida a classe 'justify-content-between' -->
                                <h5>Consulta do Paciente</h5> <!-- Texto alinhado à esquerda -->
                                <!-- Avatar alinhado à direita com 'ml-auto' -->
                                <img src="{{atendimento?.avatar || this.avatar}}" class="ml-auto" style="height: 55px; width: 55px; border-radius: 50%;">
                                <button type="button" class="btn" (click)="toggleCollapseheader('dadosPaciente')" title="Colapsar/Expandir">
                                  <i class="fa fa-angle-down"></i>
                                </button>
                              </div>
                            </div>
                          </div>
                          
                        <div class="form-row align-items-center collapse-content" id="dadosPaciente">

                          <div class="form-group col-md-6">
                            <div class="form-group">
                                <div class="form-row">
                                    <div class="mr-2"><label><strong>Nome do Paciente:</strong></label></div>
                                    <label>{{atendimento.nomePaciente}}</label>
                                </div>
                                <div class="form-row">
                                    <div class="mr-2"><label><strong>Tempo de Vida:</strong></label></div>
                                    <label>{{atendimento.dateNasc}}</label>
                                </div>
                                <div class="form-row">
                                    <div class="mr-2"><label><strong>Data do Atendimento:</strong></label></div>
                                    <label>{{atendimento.data}} {{atendimento.horario}}</label>
                                </div>
                                <div class="form-row">
                                    <div class="mr-2"><label><strong>Especialidade da Consulta:</strong></label></div>
                                    <label>{{atendimento.especialidade}}</label>
                                </div>
                                <div class="form-row">
                                    <div class="mr-2"><label><strong>Nome da Mãe:</strong></label></div>
                                    <label>{{atendimento.nameMother}}</label>
                                </div>
                                <div class="form-row">
                                    <div class="mr-2"><label><strong>Nome do Pai:</strong></label></div>
                                    <label>{{atendimento.nameFather}}</label>
                                </div>
                                <div class="form-row">
                                    <div class="mr-2"><label><strong>Consulta de Retorno:</strong></label></div>
                                    <label>{{ atendimento.isReturn ? 'Sim' : 'Não' }}</label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group col-md-6">
                          <div class="form-group">
                              <div class="form-row">
                                  <div class="mr-2"><label><strong>Data da Última Consulta:</strong></label></div>
                                  <label>{{atendimento.ultimaConsulta}}</label>
                              </div>
                              <div class="form-row">
                                  <div class="mr-2"><label><strong>Modalidade:</strong></label></div>
                                  <label>{{atendimento.modalidade}}</label>
                              </div>
                              <div class="form-row">
                                  <div class="mr-2"><label><strong>Sexo:</strong></label></div>
                                  <label>{{atendimento.sexo}}</label>
                                  <div class="mr-2"><label></label></div>
                              </div>
                              <div class="form-row">
                                  <div class="mr-2"><label><strong>Grupo Sanguíneo:</strong></label></div>
                                  <label>{{atendimento.tipoSanguineo}}</label>
                                  <div class="mr-2"><label></label></div>
                              </div>
                              <div class="form-row">
                                  <div class="mr-2"><label><strong>Telefone Paciente:</strong></label></div>
                                  <label>{{atendimento.telefone}}</label>
                              </div>
                              <div class="form-row">
                                  <div class="mr-2"><label><strong>Email Paciente:</strong></label></div>
                                  <label>{{atendimento.email}}</label>
                              </div>
                          </div>
                      </div>
                      
                        </div>
                    </nb-card-body>
                </nb-card>
                <nb-card class="custom-card">
                  <nb-card-body>
                    <div class="card-actions">
                      <button (click)="consultaHistorico(true)" class="action-button" [ngClass]="{'action-button-active': iconeAtivo === 'historico'}">
                        <nb-icon class="action-icon" icon="file-text-outline" style="color: white;"></nb-icon>
                        <span>Consultar Histórico</span>
                      </button>
                      <button *ngIf="atendimento.status === '03 - Consulta Confirmada' && !checkedConsulta" (click)="detalhesConsulta()" class="action-button" [ngClass]="{'action-button-active': iconeAtivo === 'atendimento'}">
                        <nb-icon class="action-icon" icon="wifi-outline" style="color: white;"></nb-icon>
                        <span>Atendimento</span>
                      </button>
                    </div>
                  </nb-card-body>
                </nb-card>
                
                <div *ngIf="isDetalhes">
                    <form id="form-consulta-paciente" [formGroup]="formConsultaPaciente">
                        <nb-card>

                            <nb-card-body>

                                <div class="form-group col-md -12 d-flex justify-content-between align-items-center input-medica">
                                    <label><h6>Dados Gerais do Paciente:</h6></label>
                                    <button type="button" class="btn" (click)="toggleCollapseheader('dadosGerais')" title="Colapsar/Expandir">
                                      <i class="fa fa-angle-down"></i>
                                    </button>
                                  </div>

                                  <div class="form-group col-md-12 collapse-content" id="dadosGerais">
                                    <div class="row">
                                      <div class="col-md-9">
                                        <div class="row">
                                          <div class="col-md-3">
                                            <label for="altura">Altura (CM)</label>
                                            <input class="form-control" name="altura" id="altura" type="text" formControlName="altura" pattern="\\d+(\\.\\d{1,2})?" title="Exemplo 86" (onblur)="validar_valor(value)">
                                          </div>
                                          <div class="col-md-3">
                                            <label for="peso">Peso (kg)</label>
                                            <input class="form-control" name="peso" id="peso" type="text" formControlName="peso" pattern="\\d+(\\.\\d{1,2})?" title="Por favor, insira o número como 1.0 ou 1,0" (onblur)="validar_valor(value)">
                                          </div>
                                          <div class="col-md-3">
                                            <label for="imc">Valor</label>
                                            <input class="form-control" name="imc" id="imc" type="text" formControlName="imc" disabled />
                                          </div>
                                          <div class="col-md-3">
                                            <label for="faixaIMC">Resultado</label>
                                            <input class="form-control" name="faixaIMC" id="faixaIMC" type="text" formControlName="faixaIMC" disabled />
                                          </div>
                                        </div>
                                      </div>
                                      <div class="col-md-3 text-right">
                                        <button class="btn btn-success" (click)="calcularIMC(formConsultaPaciente)">
                                          IMC
                                        </button>
                                      </div>
                                    </div>
                                  
                                        <div style="margin-top: 10px;"><label><h6>Dados Especificos de {{atendimento.especialidade}} :</h6></label></div>
                                  
                                        <div class="row">
                                          <div class="col-md-3">
                                              <label for="circCabeca">Circ. Craniana</label>
                                              <input class="form-control" name="circCabeca" id="circCabeca" type="text" formControlName="circCabeca" />
                                          </div>
                                          <div class="col-md-3">
                                              <label for="circAbdomen">Circ. Abdominal</label>
                                              <input class="form-control" name="circAbdomen" id="circAbdomen" type="text" formControlName="circAbdomen" />
                                          </div>
                                          <div class="col-md-3">
                                              <label for="tempoRetorno">Retorno (Dias)* </label>
                                              <input class="form-control" name="tempoRetorno" id="tempoRetorno" type="text" formControlName="tempoRetorno" />
                                          </div>
                                          <div class="col-md-3 d-flex justify-content-end align-items-end">
                                              <button class="btn btn-warning btn-sm mr-2" (click)="UltimaConsulta()">
                                                  Última Consulta
                                              </button>
                                          </div>
                                      </div>
                                      <div class="row" style="margin-top: 10px;">
                                        <div class="col-md-12 d-flex justify-content-end">
                                            <button class="btn btn-success btn-primary me-2" (click)="ChartCrescimento(formConsultaPaciente.value)">
                                                Gerar Percentil
                                            </button>
                                            <button class="btn btn-success btn-warning" (click)="ChartCrescimentoZ(formConsultaPaciente.value)">
                                                Gerar Z-Score
                                            </button>
                                        </div>
                                    </div>
                                    
                                      
                                      

</div>
                                    
                            </nb-card-body>
                        </nb-card>
                        <nb-card>
                          <nb-card-body>
                            <div class="form-group col-md-12 d-flex justify-content-between align-items-center input-medica">
                              <label><h6>Gráficos de Evolução:</h6></label>
                              <button type="button" class="btn" (click)="toggleCollapseheader('grafico')" title="Colapsar/Expandir">
                                <i class="fa fa-angle-down"></i>
                              </button>
                            </div>
                            <div id="grafico">
                                <canvas #heightZChartCanvas id="canvas" class="half-width" style="margin-bottom: 5px;"></canvas>
                                <canvas #weightZChartCanvas id="peso" class="half-width" style="margin-top: 5px;"></canvas>      
                                <canvas #circunferenciaCanvas id="circunferencia" class="half-width" style="margin-top: 5px;"></canvas>
                                <canvas #heightChartCanvas id="canvas" class="half-width" style="margin-bottom: 5px;"></canvas>
                                <canvas #weightChartCanvas id="peso" class="half-width" style="margin-top: 5px;"></canvas>
                                <canvas #pesoChartCanvas id="pesoChartCanvas" class="half-width" style="margin-top: 5px;"></canvas>
                            </div>

                          </nb-card-body>
                        </nb-card>
                        
                        <nb-card>
                            <nb-card-body>

                                <div class="form-group col-md-12">
                                    <div class="d-flex justify-content-between align-items-center input-medica">
                                      <h5>Dados do Atendimento</h5>
                                      <button type="button" class="btn" (click)="toggleCollapseheader('dadosAtendimento')" title="Colapsar/Expandir">
                                        <i class="fa fa-angle-down"></i>
                                      </button>
                                    </div>
                                    <!-- Início do conteúdo colapsável -->
                                    <div id="dadosAtendimento" class="collapse-content" >
                                      <!-- Conteúdo do atendimento, incluindo a prescrição -->
                                      <div class="form-row">
                                        <div class="col-lg-12">
                                          <div class="inputprescricao input-medica">
                                            <div class="d-flex justify-content-between">
                                              <label for="prescricaoMedica"><h6>Prescrição*</h6></label>
                                              <div class="form-group col-md-6">
                                                <div class="form-group">
                                                    <label for="nome">Modelos de Prescrição</label>
                                                    <select class="form-control" formControlName="prescricao"
                                                        (change)="onTemplateChange($event.target.value,'prescricao')">
                                                        <option value="null" selected>SELECIONE</option>
                                                        <option *ngFor="let prescricao of listPrescricao; let i = index" [value]="i">{{ prescricao.title }}</option>
                                                    </select>
                                                </div>
                                            </div>
                                            
                                              <!-- Botão para colapsar/expandir com ícone -->
                                              <button type="button" class="btn" (click)="toggleCollapse('prescricaoMedica')" title="Colapsar/Expandir">
                                                <i class="fa fa-angle-down"></i>
                                              </button>
                                            </div>
                                            <textarea autosize class="form-control" formControlName="prescricaoMedica"
                                            rows="3" id="prescricaoMedica" placeholder="Informe a Prescrição médica"
                                            (input)="htmldecodeHexadecimalString($event.target, $event.target.value)" maxlength="20000"></textarea>
                                  
                                            <p class="text-muted">
                                              <small>
                                                <span class="caracteres" name="txtArea">{{ tamMedica }}</span>
                                              </small>
                                              quantidade máxima de caracteres
                                            </p>
                                          </div>
                                        </div>
                                      </div>
                                      
                                      <!-- Outros conteúdos do atendimento aqui -->
                                    <!-- Fim do conteúdo colapsável -->
                                    
                                  
                                <!-- Exibe a primeira div quando this.hasSpecial for true -->
                                <div  class="form-row align-items-center">
                                    <div class="col-lg-12">
                                      <div class="input-box input-medica">
                                        <div class="d-flex justify-content-between">
                                          <label for="detalhesInterno"><h6>Detalhes (Interno)*:</h6></label>
                                          <button type="button" class="btn" (click)="toggleCollapse('detalhesInterno')" title="Colapsar/Expandir">
                                            <i class="fa fa-angle-down"></i>
                                          </button>
                                        </div>
                                        <textarea autosize class="form-control" formControlName="detalhesInterno"
                                        rows="3" id="detalhesInterno" placeholder="Informe Detalhes do Prontuario Interno. Estas Informações Não Aparecem Para os Pacientes."
                                        (input)="htmldecodeHexadecimalString($event.target, $event.target.value)" maxlength="20000"></textarea>
                                        <p class="text-muted"><small><span class="caracteres" name="txtArea">{{this.tamInterno}}</span></small>
                                          quantidade máxima de caracteres</p>
                                      </div>
                                    </div>
                                  </div>

                                <!-- Exibe a segunda div quando this.hasSpecial for false -->
                                <div *ngIf="this.hasSpecial"  class="form-row align-items-center">
                                    <div class="col-lg-12">
                                        <div class="input input-medica">
                                            <label for="detalhesInterno" ><h6>Histórico Importado</h6></label>
                                            <div [innerHtml]="html_string" id="detalhesInterno"></div>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-row align-items-center">
                                    <div class="col-lg-12">
                                      <div class="input input-medica">
                                        <div class="d-flex justify-content-between">
                                          <label for="detalhesCliente"><h6>Detalhes (Cliente)*:</h6></label>
                                          <button type="button" class="btn" (click)="toggleCollapse('detalhesCliente')" title="Colapsar/Expandir">
                                            <i class="fa fa-angle-down"></i>
                                          </button>
                                        </div>
                                        <textarea autosize class="form-control" formControlName="detalhesCliente"
                                        rows="3" id="detalhesCliente" placeholder="Informe Detalhes do Prontuario que Serão Exibidos aos Pacientes."
                                        (input)="htmldecodeHexadecimalString($event.target, $event.target.value)" maxlength="20000"></textarea>
                                        <p class="text-muted"><small><span class="caracteres" name="txtArea">{{this.tamCliente}}</span></small>
                                          quantidade máxima de caracteres</p>
                                      </div>
                                    </div>
                                  </div>

                                    <div class="form-row align-items-center">
                                    <div class="col-lg-12">
                                        <div class="input-exame input-medica">
                                        <div class="d-flex justify-content-between">
                                            <label for="pedidoExame"><h6>Pedido De Exame:</h6></label>
                                            <div class="form-group col-md-6">
                                              <div class="form-group">
                                                  <label for="nome">Modelos de Pedidos</label>
                                                  <select class="form-control" formControlName="pedido"
                                                      (change)="onTemplateChange($event.target.value,'pedido')">
                                                      <option value="null" selected>SELECIONE</option>
                                                      <option *ngFor="let pedido of listExames; let i = index" [value]="i">{{ pedido.title }}</option>
                                                  </select>
                                              </div>
                                          </div>
                                            <button type="button" class="btn" (click)="toggleCollapse('pedidoExame')" title="Colapsar/Expandir">
                                            <i class="fa fa-angle-down"></i>
                                            </button>
                                        </div>
                                        <textarea autosize class="form-control" formControlName="pedidoExame"
                                        rows="3" id="pedidoExame" placeholder="Informe Aqui os Pedidos de Exame."
                                        (input)="htmldecodeHexadecimalString($event.target, $event.target.value)" maxlength="20000"></textarea>
                                        <p class="text-muted"><small><span class="caracteres" name="txtArea">{{this.tamExame}}</span></small>
                                            quantidade máxima de caracteres</p>
                                        </div>
                                    </div>
                                    </div>
                                </div>
                            </div>

                            </nb-card-body>
                        </nb-card>
                        <nb-card>
                            <nb-card-body>
                                <div>
                                    <h5>Dados do Anexo:</h5>
                                </div>
                                <div class="form-row align-items-center">
                                    <div class="form-group col-md-6">
                                        <label for="urlReceita">URL da Receita</label>
                                        <input class="form-control" name="urlReceita" id="urlReceita" type="text"
                                            formControlName="urlReceita" />
                                    </div>
                                    <div class="form-group col-md-6" *ngIf="isReceita">
                                        <div mdbBtn rounded="true" outline="true" color="secondary" size="md" mdbWavesEffect>
                                            <label for="anexoReceita">Anexar Receita</label>
                                            <div class="custom-file">
                                                <input class="custom-file-input" type="file" mdbFileSelect (change)="onUploadReceita($event)"
                                                    accept="text/xml, application/pdf">
                                                <label #inputFileReceita class="custom-file-label" for="validatedCustomFile">Selecione o
                                                    arquivo...</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            
                                <div class="form-row align-items-center">
                                    <div class="form-group col-md-6">
                                        <label for="urlAtestado">URL do Atestado</label>
                                        <input class="form-control" name="urlAtestado" id="urlAtestado" type="text"
                                            formControlName="urlAtestado"  />
                                    </div>
                                    <div class="form-group col-md-6" *ngIf="isAtestado">
                                        <div mdbBtn rounded="true" outline="true" color="secondary" size="md"
                                            mdbWavesEffect>
                                            <label for="anexoAtestado">Anexar Atestado</label>
                                            <div class="custom-file">
                                                <input class="custom-file-input" type="file" mdbFileSelect
                                                    (change)="onUploadAtestado($event, $event.target)"
                                                    accept="text/xml, application/pdf">
                                                <label #inputFileAtestado class="custom-file-label"
                                                    for="validatedCustomFile">Selecione o
                                                    arquivo...</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-row align-items-center">
                                    <div class="form-group col-md-6">
                                        <label for="urlExame">URL Do Exame</label>
                                        <input class="form-control" name="urlExame" id="urlExame" type="text"
                                            formControlName="urlExame"  />
                                    </div>
                                    <div class="form-group col-md-6" *ngIf="isReceita">
                                        <div mdbBtn rounded="true" outline="true" color="secondary" size="md"
                                            mdbWavesEffect>
                                            <label for="anexoReceita">Anexar Exame</label>
                                            <div class="custom-file">
                                                <input class="custom-file-input" type="file" mdbFileSelect
                                                    (change)="onUploadAtestado($event, $event.target)"
                                                    accept="text/xml, application/pdf">
                                                <label #inputFileReceita class="custom-file-label"
                                                    for="validatedCustomFile">Selecione o
                                                    arquivo...</label>
                                            </div>
                                        </div>
                                    </div>
                                  
                                </div>
                                </nb-card-body>
                            </nb-card>
                            <nb-card>
                            <nb-card-body *ngIf="bloqueioSave">

                                  <div>
                                    <h5>Agendamento de Retorno:</h5>
                                </div>

                                <div class="form-group align-items-center">
                                  <div class="row">
                                    <div class="col-md-4">
                                      <label class="encaixe">Deseja Agendar o Retorno?*</label>
                                      <div class="d-flex align-items-center">
                                        <div class="form-check form-check-inline">
                                          <input class="form-check-input" type="radio" id="AgendarRetornoSim" name="agendarRetorno" value="S" formControlName="agendarRetorno" (click)="agendarRetorno('S',formConsultaPaciente.value)">
                                          <label class="form-check-label" for="AgendarRetornoSim">Sim</label>
                                        </div>
                                        <div class="form-check form-check-inline">
                                          <input class="form-check-input" type="radio" id="AgendarRetornoNao" name="agendarRetorno" value="N" formControlName="agendarRetorno" (click)="agendarRetorno('N',formConsultaPaciente.value)">
                                          <label class="form-check-label" for="AgendarRetornoNao">Não</label>
                                        </div>
                                      </div>
                                    </div>
                                    <div class="col-md-4" *ngIf="isretorno">
                                      <label class="encaixe">Será de Encaixe?*</label>
                                      <div class="d-flex align-items-center">
                                        <div class="form-check form-check-inline">
                                          <input class="form-check-input" type="radio" id="AgendarencaixeSim" name="encaixe" value="S" formControlName="encaixe" (click)="agendarencaixe('S',formConsultaPaciente.value)">
                                          <label class="form-check-label" for="AgendarencaixeSim">Sim</label>
                                        </div>
                                        <div class="form-check form-check-inline">
                                          <input class="form-check-input" type="radio" id="AgendarencaixeNao" name="encaixe" value="N" formControlName="encaixe" (click)="agendarencaixe('N',formConsultaPaciente.value)">
                                          <label class="form-check-label" for="AgendarencaixeNao">Não</label>
                                        </div>
                                      </div>
                                    </div>
                                  
                                    <div class="col-md-4" *ngIf="isEncaixe1">
                                              <section class="align-items-center">
                                                  <div class="col-md-12 col-xs-12">
                                                      <form #card="ngForm">
                                                          <label for="dataInicio">Informe o Horário que Deseja o Encaixe: </label>
                                                          <div class="form-row">
                                                              <section class="border-dark btn paragraph-2 mb-3"
                                                                  style="background-color: white;"
                                                                  *ngFor="let card of tipoCardEncaixe; let i = index;"
                                                                  >
                                                                  <div class="col-md-12">
                                                                      <label for="horaInicio">Hora de Início</label>
                                                                      <div class="row pl-3">
                                                                          <input type="time" name="appt" required
                                                                              name="card{{card.id}}"
                                                                              [(ngModel)]="card.horaInicio" />
                                                                      </div>
                                                                  </div>
                                                                  <div class="col-md-12">
                                                                      <label for="horaFim">Hora Fim</label>
                                                                      <div class="row pl-3">
                                                                          <input type="time" name="appt" required
                                                                              name="car{{card.id}}"
                                                                              [(ngModel)]="card.horaFim" />
                                                                      </div>
                                                                  </div>
                                                                  <div class="form-group">
                                                                      <button class="btn btn-primary mt-2"
                                                                          (click)="pesquisarHorario(formConsultaPaciente.value,card)">
                                                                          Pesquisar
                                                                      </button>
                                                                  </div>
                                                              </section>
                                                          </div>
                                                      </form>
                                                  </div>
                                              </section>
                                      </div>
                                  </div>
                                  <div class="form-row align-items-center" *ngIf="isEncaixe2">
                                    <div class="form-group col-md-4">
                                        <div class="form-group">
                                            <label for="horarioSelected">Horário Selecionado:</label>
                                            <input class="form-control" name="horarioSelected" id="horarioSelected "
                                            type="text" formControlName="horarioSelected" [value]="horarioSelecionado" disabled />
                                        </div>
                                    </div>
                                
                                </div>
                                </div>
                                

                                <div *ngIf="isHorario">
                                    <div class="form-group col-md-6">
                                        <h6 class="pt-3">Selecione o Horário da Consulta</h6>
                                    </div>
                                        <div class="modal-content">
                                            <div class="modal-body">
                                                <div class="card-columns">
                                                    <div class="card"
                                                         [ngClass]="{'card-ocupado': card.statusCard === 'Ocupado', 'card-disponivel': card.statusCard === 'Disponível'}"
                                                         *ngFor="let card of tipoCard; let i = index;"
                                                         >
                                                        <div class="card-body">
                                                            <div class="form-row align-items-center">
                                                                <div class="col-md-2">
                                                                    <i class="fa fa-calendar image fa-2x text-primary" aria-hidden="true"></i>
                                                                </div>
                                                                <div class="col-md-8">
                                                                    <div class="div-tamanho">
                                                                        <label for="data" class="m-0">Data: {{ card.data }}</label>
                                                                        <label for="data" class="m-0">Horário: {{ card.horario }}</label>
                                                                        <br> <!-- Adicione uma quebra de linha aqui -->
                                                                        <label>Situação: {{ card.statusCard }}</label>
                                                                    </div>
                                                                    <!-- Ícone ou botão para seleção (exemplo) -->
                                                                    <button *ngIf="card.statusCard === 'Disponível'" class="btn btn-primary" (click)="confHorario(card, formConsultaPaciente.value)">Selecionar</button>                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>                                

                            </nb-card-body>
                        </nb-card>

                        <nb-card>
                          <nb-card-body>
                            <div class="form-row" *ngIf="!atendimento.isReturn">
                              <div class="col-md-12">
                                  <div class="text-left" *ngIf="bloqueioSave">
                                      <div>
                                          <h5>Emissão de Nota Fiscal:</h5>
                                      </div>
                                      <label class="encaixe">Emitir Nota Fiscal?*</label>
                                      <div class="d-flex align-items-center">
                                          <div class="form-check form-check-inline">
                                              <input class="form-check-input" type="radio" id="EmitirNotaFiscalSim" name="emitirNotaFiscal" value="S" formControlName="emitirNotaFiscal" (click)="emitirNotaFiscal('S',formConsultaPaciente.value)">
                                              <label class="form-check-label" for="EmitirNotaFiscalSim">Sim</label>
                                          </div>
                                          <div class="form-check form-check-inline">
                                              <input class="form-check-input" type="radio" id="EmitirNotaFiscalNao" name="emitirNotaFiscal" value="N" formControlName="emitirNotaFiscal" (click)="emitirNotaFiscal('N',formConsultaPaciente.value)">
                                              <label class="form-check-label" for="EmitirNotaFiscalNao">Não</label>
                                          </div>
                                      </div>
                                  </div>
                              </div>
                          </div>
                          
                                
                              </nb-card-body>
                              </nb-card>

                        

                        <nb-card>
                            <nb-card-body>
                                <div class="form-row">
                                    <div class="col-md-12">
                                      <div class="text-right" *ngIf="bloqueioSave">
                                        <button class="btn btn-warning col-md-2" (click)="salvareContinuar(formConsultaPaciente.value)" [disabled]="isSaving">
                                          Salvar e Continuar
                                        </button>
                                      </div>
                                      <div class="text-right" style="margin-top: 20px;" *ngIf="bloqueioSave">
                                        <button class="btn btn-success col-md-2" (click)="salvar(formConsultaPaciente.value)" [disabled]="isSaving">
                                          Salvar e Finalizar
                                        </button>
                                      </div>
                                    </div>
                                  </div>
                                  
                                </nb-card-body>
                                </nb-card>
                    </form>
                </div>

                <div *ngIf="isHistorico">
                    <div class="form-row align-items-center">
                        <div class="form-group col-md-12">
                            <div class="app-box">
                                <nb-card>
                                    <nb-card-body>
                                        <div class="row">
                                            <div class="col-md-4" *ngFor="let row of rowData">
                                                <nb-card>
                                                    <nb-card-header>Data da Consulta: {{ row.dateService  }} {{ row.horario  }}</nb-card-header>
                                                    <nb-card-body>
                                                        <p>Médico: {{ row.name }}</p>
                                                        <p>Tipo do Serviço: {{ row.typeService }}</p>
                                                        <p>Nome Responsável: {{ row.NameResponse }}</p>
                                                        <p>CPF Responsável: {{ row. federalIdUser }}</p>
                                                        <p>Telefone Responsável: {{ row.cellPhoneUser }}</p>
                                                        <p>Email Responsável: {{ row.emailUser }}</p>
                                                    </nb-card-body>
                                                    <div class="text-center">
                                                        <button class="btn btn-primary mb-2" (click)="visualizar(row)" title="Detalhe">
                                                          <i class="fa fa-info-circle"></i> Visualizar Consulta
                                                        </button>
                                                    </div>
                                                </nb-card>
                                            </div>
                                        </div>
                                    </nb-card-body>
                                </nb-card>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>